---
title: "PE-PSet3"
output: pdf_document
author: Drazzel Feliu - 12174100
---

```{r setup, results='hide', warning=FALSE, message=FALSE,include=FALSE}
# Clear Workspace
rm(list=ls())

# Load Libraries
library(haven)
library(reshape)
library(tidyverse)
library(magrittr)
library(survival)
library(ggplot2)
library(rdd)
library(ggpubr)
library(stargazer)
library(sciplot)
```

For this assignment, provide a write-up where you answer the questions below, selectively cutting and pasting output where needed. Be concise in your write-up; excess wordiness will be penalized. Also, submit a log file that includes commands and results for your entire analysis. The assignment makes use of AganStarrQJEData.dta, which you can find on Canvas.

In this problem set we will reproduce some of Amanda Agan and Sonja Starr’s basic results, so start by reading their paper (Ban the box, criminal records, and racial discrimination: A field experiment), which you can find on Canvas.

```{r, results='hide'}
# load data set
data <- read_dta("AganStarrQJEData.dta")
# create data table identifying class and labels for each variable
datainfo <- data.frame(variable=colnames(data),
           class=sapply(data, class)
           )
label=unlist(lapply(data, function (x) attr(x, "label")))
label <- as.data.frame(label)
label$variable <- rownames(label)
label <- label[c(2,1)]
datainfo <- left_join(datainfo, label, by = "variable")
# summary statistics of variables
summary(data)
```

# Question 1:

For this question, restrict your analysis to the set of job applications that asked about criminal records (“Box” applications) in the before period (“pre-BTB” period). (Note: there are some applications that did not have a box in the pre-BTB period, but then added them in the post- period. Agan and Star code these as “remover = -1” in their data and call them “reverse compliers.” Exclude these observations from your analysis throughout this assignment.)

```{r}
# Permanently filter data for all reverse compliers
data <- filter(data, remover!=-1)
```

## A)
What is the average callback rate for people who committed crimes? For those who didn’t? Is the difference statistically significant?

### Answer:
```{r}
# Summary of Means across both groups
data %>% group_by(crime) %>% summarise(mean = mean(response)*100)

# Significance test across two groups for the callback rate
t.test(response~crime, data = data)
```

The average callback rate for people who committed crimes is 10.94% and is 12.51% for individuals who did not commit crimes. The difference is considered statistically significant at a 95% confidence level.

## B)

Can we interpret this as a causal effect? Explain briefly.

### Answer:

Interpretating this relationship as causal currently is premature. We haven't controlled for the type of application individuals are receiving nor across other demographic controls that may have an influence on the rate of callbacks (level of education, interviewer bias through perceptions of race, geographic location of individuals, hiring needs across time). Several variables may disentangle the impact of criminal history on positive responses to applications.

# Question 2:

Now consider just the “Box” applications but include both the pre- and post-BTB periods.

## A)

Regress callback rates on race, GED, and employment gap. Include “chain”1 and “center” fixed effects. Does race appear to have an effect on callback rates? Does this coefficient have a causal interpretation?

```{r}
reg1 <- data %>% lm(response~white + ged + empgap + chain_id + center, data = .)
```

```{r results='asis'}
stargazer(reg1, type = "latex", title = "Call Back Rates With Fixed Effects", covariate.labels = c("Race = White", "GED Acquired", "Employment Gap Exists", "Chain", "Center"), digits = 6, single.row = TRUE)
```

### Answer:



## B)

Estimate the model again, but without the chain and center fixed effects. Does the
coefficient on “white” change? Why is it important to include chain and center fixed
effects?

```{r}
reg2 <- data %>% lm(response~white + ged + empgap, data = .)
```
```{r results='asis'}
stargazer(reg2, type = "latex", title = "Call Back Rates Without Fixed Effects", covariate.labels = c("Race = White", "GED Acquired", "Employment Gap Exists"), digits = 6, single.row = TRUE)
```

### Answer:



## C) 

Now add the “conviction” variable. What happens to the coefficient on “white”? If the coefficient changes, does this mean that the previous regression was subject to omitted variable bias?

```{r}
reg3 <- data %>% lm(response~white + ged + empgap + crime, data = .)
```
```{r results='asis'}
stargazer(reg3, type = "latex", title = "Call Back Rates With Crime", covariate.labels = c("Race = White", "GED Acquired", "Employment Gap Exists", "Crime Committed"), digits = 6, single.row = TRUE)
```

### Answer:



# Question 3:

The authors estimate the following model for different subsets of the data, where “Box” is an indicator for whether the application had a box asking about employment2, and X is a vector of covariates:

$$ Callback_{ij}  = \alpha + \beta_1 Box_j + \beta_2 White_i + \beta_3 Box_j * White_i + X_i\gamma + \epsilon_{ij}$$

## A)

Suppose they run this regression on the full sample, which includes both Box and non- Box applications, but only in the pre-period (don’t actually do this yet). What do $\alpha$, $\beta_1$, $\beta_2$, and $\beta_3$ tell you?

### Answer:

$\alpha$ is going to tell you the baseline response rate for all individuals who submitted applications in the sample.

## B)

Do you think “Box” and “non-Box” stores might differ in systematic ways, besides their decision to include a box asking about criminal history? In other words, do we think this variable is “as-if” randomly assigned?

### Answer:

This variable is not "as-if" randomly assigned. Any store that willingly chooses to avoid using the box in principal expects to have a markedly different applicant pool, given the lack of the presence of the box. They are uniquely aware of the selection effect of knowingly removing the box and as such are probably more amenable to selection independent of criminal history.

## C)

Suppose they run the regression on just the “Box” applications in both periods (again, don’t do this yet). What is the interpretation of the coefficients now?

### Answer:



# Question 4:

For the below estimations, include controls for employment gap and ged, as well as center fixed effects. Again, exclude the so-called “reverse compliers.”

## A)

Estimate the model from question 3 on both “Box” and non-“Box” applications in just the pre-period.

### Answer:

```{r}
reg4 <- data %>% filter(., pre==1) %>% lm(response~crimbox + white + box_white + crime + ged + empgap, data = .)
summary(reg4)
```

## B)

What kind of standard errors should you use, and why?

### Answer:



## C)

Is the coefficient on “crimbox” statistically significant? What about “white” and the
interaction of “crimbox” and “white”? Interpret these findings.

### Answer:



## D)

Now estimate the model from question 3 on just “Box” applications in both periods.
Interpret the coefficients.

### Answer:

```{r}
reg5 <- data %>% filter(., crimbox==1) %>% lm(response~crimbox + white + box_white + crime + ged + empgap, data = .)
summary(reg5)
```

# Question 5:

Based on the above analysis, what are your conclusions about the effects of BTB?

### Answer:

